<div class="dashboard">
  <!-- Filters -->
  <div class="filters panel">
    <div class="panel-title">
      <lucide-angular name="activity" size="16"></lucide-angular>
      Filters
    </div>
    <div class="filters-grid">
      <label>
        Agent
        <select [(ngModel)]="selectedAgent">
          <option value="all">All</option>
          <option *ngFor="let a of agents" [value]="a">{{ a }}</option>
        </select>
      </label>
      <label>
        Store
        <select [(ngModel)]="selectedStore">
          <option value="all">All</option>
          <option *ngFor="let s of stores" [value]="s">{{ s }}</option>
        </select>
      </label>
      <label>
        From
        <input type="date" [(ngModel)]="dateFrom" />
      </label>
      <label>
        To
        <input type="date" [(ngModel)]="dateTo" />
      </label>
    </div>
  </div>

  <!-- KPI Cards -->
  <div class="cards">
    <div class="card">
      <div class="label"><lucide-angular name="activity" size="14"></lucide-angular> Total Scans</div>
      <div class="value">{{ totalScans() }}</div>
      <div class="delta up">Agent productivity</div>
    </div>
    <div class="card">
      <div class="label"><lucide-angular name="users" size="14"></lucide-angular> Avg time/article</div>
      <div class="value">{{ avgTimePerArticle }}s</div>
      <div class="delta up">Completion {{ completionRate }}%</div>
    </div>
    <div class="card">
      <div class="label"><lucide-angular name="trending-up" size="14"></lucide-angular> Avg price diff</div>
      <div class="value">{{ priceDiffAvg }}%</div>
      <div class="delta">Promo products {{ promoPercent }}%</div>
    </div>
    <div class="card">
      <div class="label"><lucide-angular name="info" size="14"></lucide-angular> Data quality</div>
      <div class="value">Err {{ dataQuality.errorRate }}% / Miss {{ dataQuality.missingCount }}</div>
      <div class="delta">Last 30 days</div>
    </div>
  </div>

  <div class="grid">
    <!-- Time-based trends: scans and price evolution -->
    <div class="panel">
      <div class="panel-title">Trends: Scans & Price Evolution</div>
      <apx-chart [series]="areaSeries"
                 [chart]="areaChart"
                 [xaxis]="areaXaxis"
                 [dataLabels]="areaDataLabels"
                 [stroke]="areaStroke"
                 [fill]="areaFill"
                 [grid]="areaGrid"
                 [theme]="areaTheme"
                 [colors]="areaColors"></apx-chart>
    </div>

    <!-- Store analysis: visits per store -->
    <div class="panel">
      <div class="panel-title">Store Analysis: Visits per Store</div>
      <apx-chart [series]="barSeries"
                 [chart]="barChart"
                 [xaxis]="barXaxis"
                 [plotOptions]="barPlotOptions"
                 [grid]="barGrid"
                 [theme]="barTheme"
                 [colors]="barColors"></apx-chart>
    </div>

    <!-- Completion rate -->
    <div class="panel">
      <div class="panel-title">Completion Rate</div>
      <apx-chart [series]="radialSeries"
                 [chart]="radialChart"
                 [labels]="radialLabels"
                 [theme]="radialTheme"
                 [colors]="radialColors"></apx-chart>
    </div>
  </div>

  <!-- Extra charts -->
  <div class="grid">
    <div class="panel">
      <div class="panel-title">Promo Share</div>
      <apx-chart [series]="pieSeries" [chart]="pieChart" [labels]="pieLabels"></apx-chart>
    </div>
    <div class="panel">
      <div class="panel-title">Average Visit Duration</div>
      <apx-chart [series]="durationSeries"
                 [chart]="durationChart"
                 [xaxis]="durationXaxis"
                 [plotOptions]="durationPlotOptions"
                 [grid]="durationGrid"
                 [theme]="durationTheme"
                 [colors]="durationColors"></apx-chart>
    </div>
  </div>

  <!-- Map of stores visited -->
  <div class="panel">
    <div class="panel-title"><lucide-angular name="map" size="16"></lucide-angular> Stores Visited</div>
    <div id="storesMap" style="height: 320px; border-radius: 12px; overflow: hidden"></div>
  </div>

  <!-- Price analysis table -->
  <div class="panel table">
    <div class="panel-title">Price Analysis</div>
    <div class="two-col">
      <table>
        <thead>
        <tr><th>Top Expensive</th><th>Δ</th></tr>
        </thead>
        <tbody>
        <tr *ngFor="let r of topExpensive"><td>{{ r.name }}</td><td>{{ r.diff }}</td></tr>
        </tbody>
      </table>
      <table>
        <thead>
        <tr><th>Top Cheap</th><th>Δ</th></tr>
        </thead>
        <tbody>
        <tr *ngFor="let r of topCheap"><td>{{ r.name }}</td><td>{{ r.diff }}</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Productivity ranking -->
  <div class="panel table">
    <div class="panel-title">Top 5 Agents</div>
    <table>
      <thead>
      <tr><th>Agent</th><th>Score</th></tr>
      </thead>
      <tbody>
      <tr *ngFor="let r of ranking"><td>{{ r.agent }}</td><td>{{ r.score }}</td></tr>
      </tbody>
    </table>
  </div>
</div>
